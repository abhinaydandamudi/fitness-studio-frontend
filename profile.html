<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Profile | Revz Fitness</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-image: url('https://static.vecteezy.com/system/resources/thumbnails/026/781/389/small_2x/gym-interior-background-of-dumbbells-on-rack-in-fitness-and-workout-room-photo.jpg');
      background-size: cover;
      background-attachment: fixed;
      color: #000;
    }
    .profile-container {
      background-color: rgba(255, 255, 255, 0.95);
      padding: 40px;
      margin-top: 50px;
      border-radius: 15px;
      text-align: center;
      width: 100%;
    }
    .profile-container img {
      border-radius: 50%;
      width: 100px;
      height: 100px;
      object-fit: cover;
    }
    .section {
      margin-top: 40px;
      text-align: left;
    }
    .small-chart {
      max-width: 150px;
      margin: auto;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <a class="navbar-brand d-flex align-items-center" href="about.html">
      <img src="logo1.png" alt="Revz Fitness Logo" style="height: 50px; width: auto; margin-right: 10px;">
      Revz Fitness
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About Us</a></li>
        <li class="nav-item"><a class="nav-link" href="courses.html">Courses</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
    </div>
  </nav>

  <div class="container d-flex justify-content-center">
    <div class="profile-container col-md-8">
      <img id="profilePic" src="" alt="Profile Picture">
      <h2 id="profileName" class="mt-3"></h2>
      <p id="profileEmail"></p>

      <div class="section">
        <h4>My Courses</h4>
        <ul id="coursesList" class="list-group"></ul>
      </div>

      <div class="section">
        <h4>Daily Workouts</h4>
        <ul id="workoutList" class="list-group"></ul>
      </div>

      <div class="section text-center">
        <h4>Subscription Progress</h4>
        <div class="small-chart">
          <canvas id="subscriptionChart" width="200" height="200"></canvas>
        </div>
      </div>

      <button class="btn btn-danger mt-4" onclick="logout()">Log Out</button>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("revzUser"));
    if (!user) {
      alert("You must be logged in to view this page.");
      window.location.href = "login.html";
    } else {
      const username = user.email.split("@")[0];
      document.getElementById("profileName").innerText = `Welcome, ${username}!`;
      document.getElementById("profileEmail").innerText = `Email: ${user.email}`;

      // Predefined random profile images
      const profileImages = [
        "https://randomuser.me/api/portraits/men/11.jpg",
        "https://randomuser.me/api/portraits/men/31.jpg",
        "https://randomuser.me/api/portraits/men/51.jpg"
      ];

      // Get a consistent image per user
      function getProfileImage(username) {
        let hash = 0;
        for (let i = 0; i < username.length; i++) {
          hash = username.charCodeAt(i) + ((hash << 5) - hash);
        }
        const index = Math.abs(hash % profileImages.length);
        return profileImages[index];
      }

      document.getElementById("profilePic").src = getProfileImage(username);

      // Example per-user subscription info
      const subscriptionData = {
        "user1@example.com": { totalDays: 30, daysUsed: 10 },
        "user2@example.com": { totalDays: 60, daysUsed: 45 },
        "user3@example.com": { totalDays: 90, daysUsed: 20 }
      };

      const userSubscription = subscriptionData[user.email] || { totalDays: 30, daysUsed: 15 };
      const { totalDays, daysUsed } = userSubscription;
      const daysLeft = totalDays - daysUsed;

      // Render pie chart
      const ctx = document.getElementById('subscriptionChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Used', 'Remaining'],
          datasets: [{
            data: [daysUsed, daysLeft],
            backgroundColor: ['#dc3545', '#28a745']
          }]
        },
        options: {
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    // Simulated course and workout data
    const courses = ["Strength Training", "HIIT", "Yoga Basics"];
    const workouts = ["Push-ups", "Squats", "Plank (1 min)", "Jumping Jacks"];

    const courseList = document.getElementById("coursesList");
    const workoutList = document.getElementById("workoutList");

    courses.forEach(course => {
      const li = document.createElement("li");
      li.className = "list-group-item";
      li.innerText = course;
      courseList.appendChild(li);
    });

    workouts.forEach(workout => {
      const li = document.createElement("li");
      li.className = "list-group-item";
      li.innerText = workout;
      workoutList.appendChild(li);
    });

    function logout() {
      localStorage.removeItem("revzUser");
      window.location.href = "login.html";
    }
  </script>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3 mt-5">
    <p>&copy; 2025 Revz Fitness. All Rights Reserved.</p>
  </footer>
</body>
</html>
